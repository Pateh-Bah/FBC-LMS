{% extends 'base.html' %}
{% load static %}

{% block title %}My Library Portal - {{ system_name|default:"FBC Library" }}{% endblock %}

{% block content %}
<!-- Classical Library Header -->
<div class="relative bg-gradient-to-r from-library-burgundy via-library-navy to-library-burgundy rounded-none shadow-2xl mb-12">
    <div class="absolute inset-0 bg-black opacity-20"></div>
    <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"none\"><path d=\"M0,50 Q250,20 500,50 T1000,50 L1000,100 L0,100 Z\" fill=\"%23ffffff\" fill-opacity=\"0.05\"/></svg>');"></div>
    
    <div class="relative z-10 px-8 py-16">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <!-- Scholar's Profile -->
                    <div class="w-20 h-20 bg-library-gold rounded-full flex items-center justify-center shadow-xl animate-glow">
                        <i class="fas fa-user-graduate text-2xl text-library-navy"></i>
                    </div>
                    <div>
                        <h1 class="font-serif text-5xl font-bold text-white mb-2 tracking-wide">
                            Welcome Back,
                            <span class="text-library-gold">{{ user.get_full_name|default:user.username }}</span>
                        </h1>
                        <p class="text-library-cream text-xl font-body italic">
                            "A reader lives a thousand lives before he dies" - Your scholarly journey continues
                        </p>
                        <div class="flex items-center space-x-6 mt-4">
                            <div class="flex items-center space-x-2 bg-white bg-opacity-10 rounded-lg px-4 py-2 backdrop-blur-sm">
                                <i class="fas fa-graduation-cap text-library-gold"></i>
                                <span class="text-library-cream font-semibold">{{ user.get_user_type_display }}</span>
                            </div>
                            <div class="flex items-center space-x-2 bg-white bg-opacity-10 rounded-lg px-4 py-2 backdrop-blur-sm">
                                <i class="fas fa-calendar-day text-library-gold"></i>
                                <span class="text-library-cream">{% now "F j, Y" %}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Classical Book Decoration -->
                <div class="hidden xl:block">
                    <div class="w-40 h-40 relative">
                        <div class="absolute inset-0 border-4 border-library-gold rounded-full animate-float opacity-30"></div>
                        <div class="absolute inset-4 border-2 border-library-cream rounded-full animate-float opacity-50" style="animation-delay: 1s;"></div>
                        <div class="absolute inset-8 bg-library-gold rounded-full flex items-center justify-center shadow-xl">
                            <i class="fas fa-book-open text-3xl text-library-navy"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Subscription Status Alert for Students -->
{% if user.user_type == 'student' and not user.is_subscription_active %}
<div class="bg-gradient-to-r from-amber-50 via-orange-50 to-red-50 border-l-8 border-library-gold rounded-2xl p-8 mb-12 shadow-xl">
    <div class="flex items-center">
        <div class="w-16 h-16 bg-library-gold rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
            <i class="fas fa-exclamation-triangle text-library-navy text-2xl"></i>
        </div>
        <div class="ml-6">
            <h3 class="font-serif text-2xl font-bold text-library-burgundy mb-2">Subscription Renewal Required</h3>
            <p class="text-library-navy font-body text-lg leading-relaxed">Your library privileges have expired. Please renew your subscription to continue accessing our extensive collection.</p>
            <div class="mt-4">
                <a href="#" class="inline-flex items-center px-6 py-3 bg-library-gold hover:bg-yellow-600 text-library-navy rounded-xl text-lg font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    <i class="fas fa-credit-card mr-3"></i>
                    Renew Membership
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Scholar's Statistics -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
    <!-- Literary Holdings -->
    <div class="group relative bg-white rounded-2xl shadow-xl border-l-4 border-library-burgundy overflow-hidden hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
        <div class="absolute top-0 right-0 w-20 h-20 bg-library-burgundy opacity-5 rounded-bl-full"></div>
        <div class="relative p-8">
            <div class="flex items-center justify-between">
                <div>
                    <div class="w-14 h-14 bg-library-burgundy bg-opacity-10 rounded-xl flex items-center justify-center mb-6 group-hover:bg-opacity-20 transition-colors">
                        <i class="fas fa-book text-2xl text-library-burgundy"></i>
                    </div>
                    <h3 class="font-serif text-4xl font-bold text-library-burgundy mb-3">{{ active_borrowings.count|default:0 }}</h3>
                    <p class="text-warm-gray-600 font-body text-lg">Books in Possession</p>
                    <div class="mt-4">
                        {% if active_borrowings.count > 0 %}
                            <div class="flex items-center text-library-sage text-sm font-bold">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span>{{ active_borrowings.count }} Active Loan{{ active_borrowings.count|pluralize }}</span>
                            </div>
                        {% else %}
                            <div class="flex items-center text-warm-gray-500 text-sm font-semibold">
                                <i class="fas fa-book-dead mr-2"></i>
                                <span>No books currently borrowed</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Obligations -->
    <div class="group relative bg-white rounded-2xl shadow-xl border-l-4 border-red-600 overflow-hidden hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
        <div class="absolute top-0 right-0 w-20 h-20 bg-red-600 opacity-5 rounded-bl-full"></div>
        <div class="relative p-8">
            <div class="flex items-center justify-between">
                <div>
                    <div class="w-14 h-14 bg-red-100 rounded-xl flex items-center justify-center mb-6 group-hover:bg-red-200 transition-colors">
                        <i class="fas fa-balance-scale text-2xl text-red-600"></i>
                    </div>
                    <h3 class="font-serif text-4xl font-bold text-red-600 mb-3">${{ total_fines|default:"0.00" }}</h3>
                    <p class="text-warm-gray-600 font-body text-lg">Outstanding Penalties</p>
                    <div class="mt-4">
                        {% if total_fines > 0 %}
                            <div class="flex items-center text-red-600 text-sm font-bold">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <span>Settlement Required</span>
                            </div>
                        {% else %}
                            <div class="flex items-center text-library-sage text-sm font-bold">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span>Account in Good Standing</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Communications -->
    <div class="group relative bg-white rounded-2xl shadow-xl border-l-4 border-library-sage overflow-hidden hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
        <div class="absolute top-0 right-0 w-20 h-20 bg-library-sage opacity-5 rounded-bl-full"></div>
        <div class="relative p-8">
            <div class="flex items-center justify-between">
                <div>
                    <div class="w-14 h-14 bg-library-sage bg-opacity-10 rounded-xl flex items-center justify-center mb-6 group-hover:bg-opacity-20 transition-colors relative">
                        <i class="fas fa-scroll text-2xl text-library-sage"></i>
                        {% if unread_notifications > 0 %}
                            <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center animate-pulse">{{ unread_notifications }}</span>
                        {% endif %}
                    </div>
                    <h3 class="font-serif text-4xl font-bold text-library-sage mb-3">{{ unread_notifications|default:0 }}</h3>
                    <p class="text-warm-gray-600 font-body text-lg">Unread Messages</p>
                    <div class="mt-4">
                        {% if unread_notifications > 0 %}
                            <div class="flex items-center text-library-sage text-sm font-bold">
                                <i class="fas fa-envelope mr-2"></i>
                                <span>{{ unread_notifications }} Awaiting Review</span>
                            </div>
                        {% else %}
                            <div class="flex items-center text-warm-gray-500 text-sm font-semibold">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span>All Messages Read</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Scholar's Dashboard -->
<div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-12">
    <!-- Current Literary Collection -->
    <div class="xl:col-span-2 bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="bg-gradient-to-r from-library-parchment to-library-cream border-b border-warm-gray-200 p-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-14 h-14 bg-library-burgundy rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-books text-white text-xl"></i>
                    </div>
                    <div>
                        <h3 class="font-serif text-2xl font-bold text-library-navy">Current Literary Collection</h3>
                        <p class="text-warm-gray-600 font-body italic">Your borrowed treasures and due dates</p>
                    </div>
                </div>
                {% if user.is_subscription_active %}
                    <a href="{% url 'fbc_books:book_list' %}" class="inline-flex items-center px-6 py-3 bg-library-burgundy text-white rounded-xl hover:bg-opacity-90 transition-colors font-bold shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                        <i class="fas fa-search mr-2"></i>
                        Discover Books
                    </a>
                {% endif %}
            </div>
        </div>
        
        <div class="p-8">
            {% if active_borrowings %}
                <div class="space-y-6">
                    {% for borrowing in active_borrowings %}
                    <div class="flex items-center space-x-6 p-6 {% if borrowing.is_overdue %}bg-red-50 border border-red-200{% else %}bg-library-parchment{% endif %} rounded-xl hover:bg-library-cream transition-all duration-300 shadow-md">
                        <div class="w-16 h-20 bg-library-burgundy rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg">
                            <i class="fas fa-book text-white text-lg"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-serif text-xl font-bold text-library-navy truncate mb-2">{{ borrowing.book.title }}</h4>
                            <p class="text-warm-gray-600 font-body text-lg">by {{ borrowing.book.author }}</p>
                            <div class="flex items-center space-x-6 mt-3">
                                <span class="text-sm text-warm-gray-500 font-semibold uppercase tracking-wide">
                                    Borrowed: {{ borrowing.borrowed_date|date:"M d, Y" }}
                                </span>
                                <span class="text-sm {% if borrowing.is_overdue %}text-red-600 font-bold{% else %}text-warm-gray-500 font-semibold{% endif %} uppercase tracking-wide">
                                    Due: {{ borrowing.due_date|date:"M d, Y" }}
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            {% if borrowing.is_overdue %}
                                <span class="inline-flex px-4 py-2 text-sm font-bold rounded-full bg-red-100 text-red-800 border border-red-300">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>Overdue
                                </span>
                            {% else %}
                                <span class="inline-flex px-4 py-2 text-sm font-bold rounded-full bg-green-100 text-green-800 border border-green-300">
                                    <i class="fas fa-check-circle mr-2"></i>Current
                                </span>
                            {% endif %}
                            <div class="mt-3">
                                <a href="{% url 'fbc_books:book_detail' borrowing.book.pk %}" class="text-library-burgundy hover:text-library-navy text-sm font-bold underline">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-16">
                    <div class="w-24 h-24 bg-warm-gray-100 rounded-full flex items-center justify-center mx-auto mb-8">
                        <i class="fas fa-book-dead text-warm-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="font-serif text-2xl font-bold text-warm-gray-700 mb-4">No Books Currently Borrowed</h3>
                    <p class="text-warm-gray-500 font-body text-lg italic mb-8">Your literary journey awaits - discover new worlds in our collection</p>
                    {% if user.is_subscription_active %}
                        <a href="{% url 'fbc_books:book_list' %}" class="inline-flex items-center px-8 py-4 bg-library-burgundy hover:bg-library-navy text-white rounded-xl text-lg font-bold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                            <i class="fas fa-search mr-3"></i>
                            Explore Our Collection
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Scholar's Quick Actions & Messages -->
    <div class="space-y-8">
        <!-- Quick Scholar Actions -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-library-sage to-library-burgundy p-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-library-gold rounded-lg flex items-center justify-center shadow-md">
                        <i class="fas fa-rocket text-library-navy text-sm"></i>
                    </div>
                    <div>
                        <h3 class="font-serif text-lg font-bold text-white">Quick Scholar Actions</h3>
                        <p class="text-library-cream text-sm font-body italic">Essential library services</p>
                    </div>
                </div>
            </div>
            <div class="p-6 space-y-4">
                <a href="{% url 'fbc_books:book_list' %}" class="group flex items-center p-4 rounded-xl hover:bg-library-parchment transition-all duration-300 border border-transparent hover:border-library-gold">
                    <div class="w-10 h-10 bg-library-burgundy bg-opacity-10 rounded-lg flex items-center justify-center group-hover:bg-opacity-20 transition-colors">
                        <i class="fas fa-search text-library-burgundy text-sm"></i>
                    </div>
                    <span class="ml-4 font-body font-bold text-library-navy group-hover:text-library-burgundy transition-colors">Discover Literature</span>
                    <i class="fas fa-chevron-right text-warm-gray-400 ml-auto group-hover:text-library-gold transition-colors"></i>
                </a>
                
                <a href="{% url 'fbc_fines:my_fines' %}" class="group flex items-center p-4 rounded-xl hover:bg-library-parchment transition-all duration-300 border border-transparent hover:border-library-gold">
                    <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center group-hover:bg-red-200 transition-colors">
                        <i class="fas fa-balance-scale text-red-600 text-sm"></i>
                    </div>
                    <span class="ml-4 font-body font-bold text-library-navy group-hover:text-red-600 transition-colors">Account Statement</span>
                    <i class="fas fa-chevron-right text-warm-gray-400 ml-auto group-hover:text-library-gold transition-colors"></i>
                </a>
                
                <a href="{% url 'fbc_notifications:notification_list' %}" class="group flex items-center p-4 rounded-xl hover:bg-library-parchment transition-all duration-300 border border-transparent hover:border-library-gold">
                    <div class="w-10 h-10 bg-library-sage bg-opacity-10 rounded-lg flex items-center justify-center group-hover:bg-opacity-20 transition-colors">
                        <i class="fas fa-scroll text-library-sage text-sm"></i>
                    </div>
                    <span class="ml-4 font-body font-bold text-library-navy group-hover:text-library-sage transition-colors">Library Messages</span>
                    <i class="fas fa-chevron-right text-warm-gray-400 ml-auto group-hover:text-library-gold transition-colors"></i>
                </a>
                
                <a href="{% url 'fbc_users:profile' %}" class="group flex items-center p-4 rounded-xl hover:bg-library-parchment transition-all duration-300 border border-transparent hover:border-library-gold">
                    <div class="w-10 h-10 bg-library-navy bg-opacity-10 rounded-lg flex items-center justify-center group-hover:bg-opacity-20 transition-colors">
                        <i class="fas fa-user-edit text-library-navy text-sm"></i>
                    </div>
                    <span class="ml-4 font-body font-bold text-library-navy group-hover:text-library-navy transition-colors">Scholar Profile</span>
                    <i class="fas fa-chevron-right text-warm-gray-400 ml-auto group-hover:text-library-gold transition-colors"></i>
                </a>
            </div>
        </div>

        <!-- Recent Library Communications -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-library-navy to-library-sage p-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-library-gold rounded-lg flex items-center justify-center shadow-md">
                        <i class="fas fa-scroll text-library-navy text-sm"></i>
                    </div>
                    <div>
                        <h3 class="font-serif text-lg font-bold text-white">Recent Communications</h3>
                        <p class="text-library-cream text-sm font-body italic">Latest library updates</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                {% if notifications %}
                    <div class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar">
                        {% for notification in notifications|slice:":5" %}
                        <div class="flex items-start space-x-4 p-4 {% if notification.unread %}bg-blue-50 border border-blue-200{% else %}bg-library-parchment{% endif %} rounded-xl transition-all duration-300">
                            <div class="w-10 h-10 bg-library-burgundy rounded-full flex items-center justify-center flex-shrink-0 shadow-md mt-1">
                                <i class="fas fa-envelope text-white text-xs"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-body font-semibold text-library-navy text-base truncate">{{ notification.description }}</p>
                                <p class="text-warm-gray-500 text-sm font-semibold mt-1">{{ notification.created_at|timesince }} ago</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="mt-6 text-center">
                        <a href="{% url 'fbc_notifications:notification_list' %}" class="inline-flex items-center px-4 py-2 bg-library-burgundy hover:bg-library-navy text-white rounded-lg text-sm font-bold transition-colors">
                            <i class="fas fa-archive mr-2"></i>View All Messages
                        </a>
                    </div>
                {% else %}
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-warm-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-envelope-open text-warm-gray-400 text-xl"></i>
                        </div>
                        <h4 class="font-serif text-lg font-semibold text-warm-gray-700 mb-2">No Messages</h4>
                        <p class="text-warm-gray-500 font-body italic">All communications up to date</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
/* Classical Library Styling */
.custom-scrollbar::-webkit-scrollbar {
    width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: #f7f3e9;
    border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background: #8b4513;
    border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #654321;
}

.animate-glow {
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from {
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
    }
    to {
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
    }
}

.animate-float {
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% {
        transform: translateY(0px);
    }
    50% {
        transform: translateY(-20px);
    }
}
</style>
{% endblock %}
